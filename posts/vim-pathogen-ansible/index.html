<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Configure Vim with Ansible"><meta itemprop=description content="If you want to maintain a base Vim configuration file while also having the ability to easily configure Vim for Pathogen package management in environments that will support it, you can do so with Ansible.
The Ansible script for this involves inserting a base .vimrc (or skipping this step if you have another method of inserting the .vimrc), and then installing Pathogen with infect() at the head of the .vimrc. This method accomplishes configuration from scratch, or addition of Pathogen to an existing configuration without destroying existing changes."><meta itemprop=datePublished content="2020-10-06T21:18:06-04:00"><meta itemprop=dateModified content="2020-10-06T22:20:50-04:00"><meta itemprop=wordCount content="437"><meta itemprop=keywords content="linux,vim,configuration,"><meta property="og:title" content="Configure Vim with Ansible"><meta property="og:description" content="If you want to maintain a base Vim configuration file while also having the ability to easily configure Vim for Pathogen package management in environments that will support it, you can do so with Ansible.
The Ansible script for this involves inserting a base .vimrc (or skipping this step if you have another method of inserting the .vimrc), and then installing Pathogen with infect() at the head of the .vimrc. This method accomplishes configuration from scratch, or addition of Pathogen to an existing configuration without destroying existing changes."><meta property="og:type" content="article"><meta property="og:url" content="/posts/vim-pathogen-ansible/"><meta property="article:published_time" content="2020-10-06T21:18:06-04:00"><meta property="article:modified_time" content="2020-10-06T22:20:50-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Configure Vim with Ansible"><meta name=twitter:description content="If you want to maintain a base Vim configuration file while also having the ability to easily configure Vim for Pathogen package management in environments that will support it, you can do so with Ansible.
The Ansible script for this involves inserting a base .vimrc (or skipping this step if you have another method of inserting the .vimrc), and then installing Pathogen with infect() at the head of the .vimrc. This method accomplishes configuration from scratch, or addition of Pathogen to an existing configuration without destroying existing changes."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Configure Vim with Ansible</title><link rel=stylesheet href=/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=/>Matt Higgins Dev Blog</a></div><nav class="site-nav hide-in-mobile"><a href=/posts/>Posts</a>
<a href=/projects/>Projects</a>
<a href=/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://github.com/vextor22 target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=/posts/>Posts</a></li><li><a href=/projects/>Projects</a></li><li><a href=/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Oct 6, 2020</span></div><h1>Configure Vim with Ansible</h1></header><div class=content><p>If you want to maintain a base Vim configuration file while also having the ability to easily configure Vim for Pathogen package management in environments that will support it, you can do so with Ansible.</p><p>The Ansible script for this involves inserting a base .vimrc (or skipping this step if you have another method of inserting the .vimrc), and then installing Pathogen with infect() at the head of the .vimrc. This method accomplishes configuration from scratch, or addition of Pathogen to an existing configuration without destroying existing changes.</p><p>The <a href=https://github.com/vextor22/ansible_scripts/blob/master/roles/dev/tasks/main.yml>complete script</a> is available on my <a href=https://github.com/vextor22/ansible_scripts>GitHub Ansible Repo</a> for my basic dev environment. I recommend that if you don&rsquo;t already, create Ansible tasks for any configuration you commonly perform in a new environment. If you keep this up to date, you&rsquo;re only ever one ansible-playbook command away from a comfortable editor and toolset.</p><h1 id=installing-pathogen>Installing Pathogen<a href=#installing-pathogen class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>To install Pathogen via Ansible, we add the following tasks to the Ansible role:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create pathogen dir</span><span class=w>
</span><span class=w>  </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>mkdir -p ~/.vim/autoload ~/.vim/bundle </span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Pull pathogen</span><span class=w>
</span><span class=w>  </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim</span><span class=w>
</span></code></pre></div><p>These tasks create the expected paths for pathogen as well as pull the pathogen Vim module itself via curl.</p><h1 id=adding-pathogen-to-vimrc>Adding Pathogen to .vimrc<a href=#adding-pathogen-to-vimrc class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>To add Pathogen to the .vimrc, we want to first detect if Pathogen has already been added, and second add Pathogen to the head of the file if it isn&rsquo;t there already.</p><p>To do this, we can use the following tasks:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>check for pathogen in vimrc</span><span class=w>
</span><span class=w>  </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;cat ~/.vimrc | grep pathogen#infect\\(\\) | wc -l&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class=l>pathogen_present</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class=l>msg=&#34;{{pathogen_present.stdout}}&#34;</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add pathogen to vimrc if not present</span><span class=w>
</span><span class=w>  </span><span class=nt>lineinfile</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>~/.vimrc</span><span class=w>
</span><span class=w>      </span><span class=nt>insertbefore</span><span class=p>:</span><span class=w> </span><span class=l>BOF</span><span class=w>
</span><span class=w>      </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;execute pathogen#infect()&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>pathogen_present.stdout == &#34;0&#34;</span><span class=w>
</span></code></pre></div><p>These tasks check for pathogen in the .vimrc file using grep to produce output if the configuration line exists. When the number of output lines, counted by wc -l, is 0, The next task will run, adding the Pathogen configuration to the .vimrc. To ensure the line is added to the beginning of the file we use insertbefore: BOF, where BOF means Beginning Of File.</p><h1 id=using-pathogen-with-ansible>Using Pathogen with Ansible<a href=#using-pathogen-with-ansible class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>Now that Pathogen is installed with Ansible, we want to install a Vim package to use it. The most visible package to install this way is <a href=https://github.com/itchyny/lightline.vim>Lightline</a>. The install for this package with Ansible and Pathogen is as simple as:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Vim - Install Lightline</span><span class=w>
</span><span class=w>  </span><span class=nt>git</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>git@github.com:itchyny/lightline.vim.git</span><span class=w>
</span><span class=w>      </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>~/.vim/bundle/lightline.vim</span><span class=w>
</span><span class=w>      </span><span class=nt>clone</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>update</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>check for laststatus in vimrc</span><span class=w>
</span><span class=w>  </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;cat ~/.vimrc | grep laststatus=2 | wc -l&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class=l>laststatus_present</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class=l>msg=&#34;{{laststatus_present.stdout}}&#34;</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add laststatus to vimrc if not present to fix lightline</span><span class=w>
</span><span class=w>  </span><span class=nt>lineinfile</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>~/.vimrc</span><span class=w>
</span><span class=w>      </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;set laststatus=2&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>laststatus_present.stdout == &#34;0&#34;</span><span class=w>
</span></code></pre></div><p>After starting Vim you should see Lightline at the bottom of the screen. With this done, you are able to install whatever other Vim packages you&rsquo;d like using Ansible. To see more examples, check out my Ansible script linked above.</p></div><div class="related-posts thin"><h2>See Also</h2><ul><li><a href=/posts/persistent-nfs-with-fstab/>Persistent NFS with FSTab</a></li><li><a href=/posts/sudoless-docker/>Sudoless Docker</a></li></ul></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=/tags/linux>linux</a></span><span class=tag><a href=/tags/vim>vim</a></span><span class=tag><a href=/tags/configuration>configuration</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>437 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-10-07 01:18 +0000</p></footer></article><div class="post-nav thin"><a class=prev-post href=/posts/persistent-nfs-with-fstab/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Persistent NFS with FSTab</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=/>Matt Higgins</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script></body></html>