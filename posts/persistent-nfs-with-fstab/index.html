<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Persistent NFS with FSTab"><meta itemprop=description content="If you want to mount a Samba network file share persistently in linux, you will want to use fstab. With fstab, the share will be remounted when the system boots, so services that depend on the share will be able to function.
Test First! Before adding the network file share to fstab, test it with mount. For my environment the resulting mount command was:
sudo mount -t cifs //<NFS server>/<NFS path> /mnt/nfs_downloads/ -o username=<username>,password=<password>,uid=$(id -u),gid=$(id -g),context=&#34;system_u:object_r:container_file_t:s0&#34; Notice the context in the options section to provide an SELinux context to the file share."><meta itemprop=datePublished content="2020-10-05T21:17:05-04:00"><meta itemprop=dateModified content="2020-10-06T22:20:50-04:00"><meta itemprop=wordCount content="281"><meta itemprop=keywords content="linux,configuration,"><meta property="og:title" content="Persistent NFS with FSTab"><meta property="og:description" content="If you want to mount a Samba network file share persistently in linux, you will want to use fstab. With fstab, the share will be remounted when the system boots, so services that depend on the share will be able to function.
Test First! Before adding the network file share to fstab, test it with mount. For my environment the resulting mount command was:
sudo mount -t cifs //<NFS server>/<NFS path> /mnt/nfs_downloads/ -o username=<username>,password=<password>,uid=$(id -u),gid=$(id -g),context=&#34;system_u:object_r:container_file_t:s0&#34; Notice the context in the options section to provide an SELinux context to the file share."><meta property="og:type" content="article"><meta property="og:url" content="/posts/persistent-nfs-with-fstab/"><meta property="article:published_time" content="2020-10-05T21:17:05-04:00"><meta property="article:modified_time" content="2020-10-06T22:20:50-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Persistent NFS with FSTab"><meta name=twitter:description content="If you want to mount a Samba network file share persistently in linux, you will want to use fstab. With fstab, the share will be remounted when the system boots, so services that depend on the share will be able to function.
Test First! Before adding the network file share to fstab, test it with mount. For my environment the resulting mount command was:
sudo mount -t cifs //<NFS server>/<NFS path> /mnt/nfs_downloads/ -o username=<username>,password=<password>,uid=$(id -u),gid=$(id -g),context=&#34;system_u:object_r:container_file_t:s0&#34; Notice the context in the options section to provide an SELinux context to the file share."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Persistent NFS with FSTab</title><link rel=stylesheet href=/css/style.min.eac77496566fd7d5768fd650ddb0b2b181ca6a2d7c5fdd6fe6b8ba4bf47e566f.css integrity="sha256-6sd0llZv19V2j9ZQ3bCysYHKai18X91v5ri6S/R+Vm8=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=/>Matt Higgins Dev Blog</a></div><nav class="site-nav hide-in-mobile"><a href=/posts/>Posts</a>
<a href=/projects/>Projects</a>
<a href=/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://github.com/vextor22 target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=/posts/>Posts</a></li><li><a href=/projects/>Projects</a></li><li><a href=/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Oct 5, 2020</span></div><h1>Persistent NFS with FSTab</h1></header><div class=content><p>If you want to mount a Samba network file share persistently in linux, you will want to use fstab. With fstab, the share will be remounted when the system boots, so services that depend on the share will be able to function.</p><h1 id=test-first>Test First!<a href=#test-first class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>Before adding the network file share to fstab, test it with mount. For my environment the resulting mount command was:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo mount -t cifs //&lt;NFS server&gt;/&lt;NFS path&gt; /mnt/nfs_downloads/ -o <span class=nv>username</span><span class=o>=</span>&lt;username&gt;,password<span class=o>=</span>&lt;password&gt;,uid<span class=o>=</span><span class=k>$(</span>id -u<span class=k>)</span>,gid<span class=o>=</span><span class=k>$(</span>id -g<span class=k>)</span>,context<span class=o>=</span><span class=s2>&#34;system_u:object_r:container_file_t:s0&#34;</span>
</code></pre></div><p>Notice the context in the options section to provide an SELinux context to the file share. This will be important to you in Fedora, Centos, RHEL or any other environment using SELinux. In my case, the files here needed to be accessed by a containerized application, so I set the container_file_t context.</p><p>Finally, with a working mount, unmount the share:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo umount /mnt/nfs_downloads
</code></pre></div><h1 id=configure-fstab>Configure fstab<a href=#configure-fstab class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>Configuring fstab to correspond to the above mount, we add a line to /etc/fstab which looks like the following:</p><pre><code>//&lt;NFS server&gt;/&lt;NFS path&gt; /mnt/nfs_downloads/ cifs username=&lt;username&gt;,password=&lt;password&gt;,uid=&lt;uid number&gt;,gid=&lt;gid number&gt;,context=&quot;system_u:object_r:container_file_t:s0&quot; 0 0
</code></pre><p>Notice that uid and gid have been changed from $(id -u) and $(id -g) to the numbers corresponding to a user directly. This is because fstab is not running in your interactive shell but at startup, and the uid and gid will not yet be set to the expected values.
Reload fstab</p><p>Reloading fstab can be done by restarting the machine. However, this is not always convenient. Alternatively you can reload fstab using mount -a:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo mount -av
</code></pre></div><h1 id=in-conclusion>In conclusion<a href=#in-conclusion class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>You now have a remote network filesystem mounted persistently to the host using fstab. Optionally, you&rsquo;ve configured the share with an SELinux context that will allow access to a containerized application.</p></div><div class="related-posts thin"><h2>See Also</h2><ul><li><a href=/posts/sudoless-docker/>Sudoless Docker</a></li></ul></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=/tags/linux>linux</a></span><span class=tag><a href=/tags/configuration>configuration</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>281 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-10-06 01:17 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=/posts/vim-pathogen-ansible/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Configure Vim with Ansible</span></a>
<a class=prev-post href=/posts/sudoless-docker/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Sudoless Docker</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=/>Matt Higgins</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script></body></html>